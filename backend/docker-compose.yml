version: "3.4"
services:
    openstead-api:
        build:
            context: ./
            dockerfile: Dockerfile
            args:
                - ENV=development
                - UID=82
                - GID=82
        environment:
            - UID=82
            - GID=82
        working_dir: /var/www/html
        volumes:
            - type: bind
              source: .
              target: /var/www/html
        extra_hosts:
            - "host.docker.internal:host-gateway"
        container_name: openstead-api
        image: openstead-api
        ports:
            - 9000:80
            - 8000:8000
        depends_on:
            - mysql
    mysql:
        image: mysql:8.0
        volumes:
            - openstead-mysql:/data.ms
        environment:
            - MYSQL_DATABASE=openstead
            - MYSQL_USER=openstead
            - MYSQL_PASSWORD=secret
            - MYSQL_ROOT_PASSWORD=secret
        ports:
            - 33062:3306
    redis:
        image: redis

volumes:
    openstead-mysql: